---
title: "Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| echo: false
options(knitr.kable.NA = "")
library(codec)

codec_data_installed <-
  fs::path_package("codec") |>
  fs::path("codec_data") |>
  fs::dir_ls() |>
  fs::path_file()
  
cd <-
  purrr::map(codec_data_installed, codec::codec_data, .progress = "reading codec data") |>
  purrr::set_names(codec_data_installed)

make_core_md <- function(x = cd[[1]]) {
  md <- purrr::keep_at(attributes(x), c("name", "title", "homepage", "version", "description"))
  md$dl_button <- downloadthis::download_dir(
    button_label = "tdr", 
    button_type = "info",
    has_icon = TRUE,
    icon = "fa fa-download",
    self_contained = TRUE,
    class = "codec_button_dl",
    path = fs::path_package("codec", "codec_data", md$name),
    output_name = md$name)
  md$schema <- knitr::kable(glimpse_schema(x))
  md$v_button <- bsplus::bs_button(glue::glue("v{md$version}"), class = "codec_button_v")
  return(md)
}

cd_md <- purrr::map(cd, make_core_md)
```

&nbsp;

```{css, echo=FALSE}
.codec_button_dl {
	font-size: 16px;
	font-family: "Source Code Pro";
}

.codec_button_v {
	font-size: 16px;
	font-family: "Source Code Pro";
	button-type: Info;
}
```

```{r}
#| echo: false
#| results: asis

purrr::walk(cd_md,
            function(.) {
              glue::glue_data(
                .,
                "<hr>",
                "## `{name}` {v_button}",
                "[**{title}**]({homepage}) {dl_button}",
                "<hr>",
                ## "read into R with:",
                ## "```r",
                ## "codec::codec_data(\"{name}\")",
                ## "```",
                ## "**About**: {description}",
                ## " ### Schema",
                "{paste(schema, collapse = '\n')}",
                "\n\n",
                "&nbsp;",
                "\n\n",
                "&nbsp;",
                "\n\n",
                .sep = "\n\n",
                .na = "") |>
                cat()
            })

```
